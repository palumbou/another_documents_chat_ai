<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Another Documents Chat AI</title>
  <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
  <link rel="stylesheet" href="/static/style-modular.css">
  <style>
    /* CSS for simplified layout */
    /* Force proper widths and prevent overflow */
    .app-container .left-sidebar {
      max-width: 380px !important;
      min-width: 380px !important;
      width: 380px !important;
      overflow-x: hidden !important;
    }
    
    /* Ensure grid layout works properly */
    @media (min-width: 769px) {
      .app-container {
        grid-template-columns: 380px 1fr !important;
      }
    }
    
    /* Settings Modal Styles */
    .settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .settings-modal-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    
    .settings-modal-content {
      position: relative;
      background: var(--background);
      border-radius: 16px;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      border: 1px solid var(--border-color);
      animation: settingsModalIn 0.3s ease-out;
    }
    
    .settings-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem 2rem;
      border-bottom: 1px solid var(--border-color);
      background: var(--background-light);
      border-radius: 16px 16px 0 0;
    }
    
    .settings-modal-header h3 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .settings-modal-body {
      padding: 1.5rem 2rem 2rem;
    }
    
    /* Button in header */
    .sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
      position: relative;
    }
    
    .sidebar-header .header-content {
      display: flex;
      align-items: center;
      width: 100%;
    }
    
    .sidebar-header h1 {
      margin: 0;
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .settings-btn {
      padding: 0.5rem;
      border-radius: 8px;
      background: var(--background-light);
      border: 1px solid var(--border-color);
      color: var(--text-secondary);
      cursor: pointer;
      position: absolute;
      right: 1.5rem;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .settings-btn:hover {
      background: var(--primary-color);
      color: white;
      transform: translateY(-50%);
    }
    
    @keyframes settingsModalIn {
      from {
        opacity: 0;
        transform: scale(0.9) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    
    /* Theme Selector Styles */
    .theme-selector {
      margin-bottom: 1.5rem;
    }
    
    .theme-selector h3 {
      margin: 0 0 1rem 0;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .theme-dropdown-container {
      margin-bottom: 0.75rem;
    }
    
    .theme-dropdown-container label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-secondary);
    }
    
    .theme-dropdown {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: var(--input-background);
      color: var(--text-primary);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .theme-dropdown:hover {
      border-color: var(--primary-color);
    }
    
    .theme-dropdown:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px var(--highlight-color);
    }
    
    .theme-dropdown optgroup {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .theme-dropdown option {
      padding: 0.5rem;
      color: var(--text-primary);
      background: var(--input-background);
    }
    
    .theme-description {
      padding: 0.5rem;
      background: var(--background-light);
      border-radius: 6px;
      border: 1px solid var(--border-light);
    }
    
    .theme-description small {
      color: var(--text-muted);
      font-style: italic;
      line-height: 1.3;
    }
    
    /* Advanced Theme Selector Styles */
    .theme-mode-section {
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: var(--background-light);
      border-radius: 8px;
      border: 1px solid var(--border-light);
    }
    
    .theme-mode-section label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .mode-description {
      margin-top: 0.5rem;
      color: var(--text-muted);
      font-style: italic;
      line-height: 1.3;
    }
    
    .theme-dropdown-wrapper {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .theme-dropdown-wrapper .theme-dropdown {
      flex: 1;
    }
    
    .theme-info-btn {
      padding: 0.5rem;
      background: var(--background-light);
      border: 1px solid var(--border-color);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .theme-info-btn:hover {
      background: var(--accent-color);
      color: white;
    }
    
    .theme-status {
      margin-top: 1rem;
      padding: 0.75rem;
      background: var(--success-color);
      color: white;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    
    .theme-preview-toast {
      animation: toastSlideIn 0.3s ease-out;
    }
    
    .toast-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    
    .toast-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    @keyframes toastSlideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    /* Quick Guide Styles */
    .quick-guide {
      margin-top: 1.5rem;
    }
    
    .quick-guide h3 {
      margin: 0 0 1rem 0;
      color: var(--primary-color);
      font-size: 1.1rem;
    }
    
    .guide-steps {
      margin-bottom: 1.5rem;
    }
    
    .step-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 1rem;
      padding: 1rem;
      background: var(--background-light);
      border-radius: 8px;
      border: 1px solid var(--border-light);
    }
    
    .step-number {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: var(--primary-color);
      color: var(--text-inverse);
      border-radius: 50%;
      font-weight: 600;
      font-size: 0.8rem;
      margin-right: 0.75rem;
      flex-shrink: 0;
    }
    
    .step-content strong {
      display: block;
      color: var(--text-primary);
      margin-bottom: 0.25rem;
    }
    
    .step-content p {
      margin: 0;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.4;
    }
    
    .features-highlight {
      margin-bottom: 1.5rem;
    }
    
    .features-highlight h4 {
      margin: 0 0 0.75rem 0;
      color: var(--accent-color);
      font-size: 1rem;
    }
    
    .features-list {
      margin: 0;
      padding-left: 0;
      list-style-type: none;
    }
    
    .features-list li {
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.4;
      padding-left: 0.5rem;
    }
    
    .tips-section h4 {
      margin: 0 0 0.75rem 0;
      color: var(--warning-color);
      font-size: 1rem;
    }
    
    .tips-section ul {
      margin: 0;
      padding-left: 0;
      list-style-type: none;
    }
    
    .tips-section li {
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
      line-height: 1.4;
      padding-left: 0.5rem;
    }
    
    .tips-section strong {
      color: var(--text-primary);
    }
    
    /* Welcome message styles */
    .welcome-message {
      max-width: 800px;
      margin: 2rem auto;
      padding: 2rem;
      text-align: center;
    }
    
    .welcome-message h2 {
      margin-bottom: 1rem;
      color: var(--text-primary);
    }
    
    .welcome-message > p {
      margin-bottom: 2rem;
      color: var(--text-secondary);
      font-size: 1.1rem;
    }
    
    .quick-guide {
      text-align: left;
      margin-top: 2rem;
    }
    
    .features-highlight {
      text-align: left;
    }
    
    .tips-section {
      text-align: left;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Left Sidebar - Projects and Chats -->
    <aside class="sidebar left-sidebar">
      <header class="sidebar-header">
        <div class="header-content">
          <h1>Another Documents Chat AI</h1>
        </div>
        <button id="toggle-settings" class="btn-icon settings-btn" title="Open settings">âš™ï¸</button>
      </header>
      
      <!-- Project Management -->
      <section class="projects-section">
        <div class="section-header">
          <h3>Projects</h3>
          <div class="project-controls">
            <button id="new-project-btn" class="btn-small" title="Create new project">+</button>
            <button id="delete-project-btn" class="btn-small btn-danger" title="Delete current project">ğŸ—‘ï¸</button>
          </div>
        </div>
        
        <div class="project-management">
          <div class="project-header">
            <label for="project-select">Project Name:</label>
            <select id="project-select" class="project-select">
              <option value="global">Global Documents</option>
            </select>
          </div>
          
          <!-- New Project Modal -->
          <div id="new-project-modal" class="modal" style="display: none;">
            <div class="modal-content">
              <h4>Create New Project</h4>
              <input type="text" id="new-project-name" placeholder="Project name" maxlength="50">
              <div class="modal-buttons">
                <button id="create-project-btn" class="btn-primary">Create</button>
                <button id="cancel-project-btn" class="btn-secondary">Cancel</button>
              </div>
              <div id="project-msg" class="status-msg"></div>
            </div>
          </div>
        </div>
        
        <div id="existing-docs">
          <div id="docs-list">Loading documents...</div>
        </div>
        
        <div class="upload-area">
          <form id="upload-form" class="upload-container">
            <input type="file"
                   name="files"
                   id="file-input"
                   multiple
                   accept=".pdf,.docx,.doc,.txt,.md,.log"
                   class="file-input">
            <label for="file-input" class="file-input-label">
              <div class="upload-content">
                <div class="upload-title">
                  <span class="upload-icon">ğŸ“</span>
                  <span class="upload-text">Choose files or drag & drop</span>
                </div>
                <span class="upload-hint">PDF, DOCX, DOC, TXT, MD, LOG</span>
                <!-- Upload buttons inside the drag & drop area -->
                <div class="upload-buttons" style="display: none;">
                  <button type="button" id="upload-btn" class="btn-primary btn-small">Upload Files</button>
                  <button type="button" id="cancel-upload-btn" class="btn-secondary btn-small">Cancel</button>
                </div>
              </div>
            </label>
            <input type="hidden" name="project" id="upload-project" value="global" aria-label="Upload project selector">
            
            <!-- Progress bar for upload -->
            <div id="upload-progress" class="upload-progress" style="display: none;">
              <div class="progress-bar">
                <div class="progress-fill"></div>
              </div>
              <div class="progress-text">Uploading...</div>
            </div>
          </form>
          
          <!-- Individual file upload progress -->
          <div id="file-upload-list" class="file-upload-list"></div>
          
          <div id="upload-msg" class="status-msg"></div>
        </div>
      </section>

      <!-- Chat History -->
      <section class="chats-section">
        <div class="section-header">
          <h3>ğŸ’¬ Chat History</h3>
          <div class="chat-controls">
            <div class="export-dropdown">
              <button id="export-chat-btn" class="btn-small" title="Export current chat">ğŸ’¾</button>
              <div class="export-dropdown-content">
                <button onclick="exportCurrentChat('json')">Export as JSON</button>
                <button onclick="exportCurrentChat('markdown')">Export as Markdown</button>
              </div>
            </div>
            <button id="new-chat-btn" class="btn-small" title="Start new chat">+</button>
          </div>
        </div>
        <div id="chat-list">
          <div class="chat-placeholder">No chats yet. Start chatting to create your first conversation!</div>
        </div>
      </section>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-container">
      <div class="chat-messages" id="chat-messages">
        <div class="welcome-message">
          <h2>ğŸ“„ Welcome to Another Documents Chat AI</h2>
          <p>Your intelligent document assistant powered by Ollama</p>
          
          <div class="quick-guide">
            <h3>ğŸš€ Quick Start Guide</h3>
            <div class="guide-steps">
              <div class="step-item">
                <span class="step-number">1</span>
                <div class="step-content">
                  <strong>Configure AI Model</strong>
                  <p>Open settings (âš™ï¸) â†’ Download a model (e.g., llama3.2) â†’ Select "Use" to activate it</p>
                </div>
              </div>
              
              <div class="step-item">
                <span class="step-number">2</span>
                <div class="step-content">
                  <strong>Upload Documents</strong>
                  <p>Drag & drop files (.pdf, .docx, .txt, .log) into the upload area or click to select</p>
                </div>
              </div>
              
              <div class="step-item">
                <span class="step-number">3</span>
                <div class="step-content">
                  <strong>Create Projects</strong>
                  <p>Organize documents into projects for better context management</p>
                </div>
              </div>
              
              <div class="step-item">
                <span class="step-number">4</span>
                <div class="step-content">
                  <strong>Start Chatting</strong>
                  <p>Ask questions about your documents or chat freely with the AI</p>
                </div>
              </div>
            </div>
            
            <div class="features-highlight">
              <h4>âœ¨ Key Features</h4>
              <ul class="features-list">
                <li>ğŸ“ Multi-format support (.pdf, .docx, .doc, .txt, .md, .log)</li>
                <li>ğŸ” OCR for scanned documents</li>
                <li>ğŸ§  Intelligent document analysis</li>
                <li>ğŸ’¬ Context-aware AI responses</li>
                <li>ğŸ—‚ï¸ Project-based organization</li>
                <li>ğŸ¨ Customizable themes and UI</li>
              </ul>
            </div>
            
            <div class="tips-section">
              <h4>ğŸ’¡ Pro Tips</h4>
              <ul>
                <li><strong>ğŸ¨ Theme Selection:</strong> Open settings to choose from various themes (Base, Catppuccin, Dracula, Tokyo Night, Gruvbox, Nord, Solarized)</li>
                <li><strong>ğŸ› Debug Mode:</strong> Enable in settings for detailed system information and troubleshooting</li>
                <li><strong>âŒ¨ï¸ Keyboard Shortcuts:</strong> Enter to send, Shift+Enter for new line in chat</li>
                <li><strong>ğŸ“„ Document Management:</strong> View document chunks, copy content, and search within files</li>
                <li><strong>ğŸ”§ Project Organization:</strong> Create projects to group related documents and maintain context</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      
      <div class="chat-input-area">
        <div class="input-container">
          <textarea id="chat-input" 
                    placeholder="Ask a question about your documents..."
                    rows="2"></textarea>
          <button id="send-btn" class="btn-send" title="Send message (Enter)">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22,2 15,22 11,13 2,9"></polygon>
            </svg>
          </button>
        </div>
        <div class="input-help">
          <small>
            <kbd>Enter</kbd> to send, <kbd>Shift+Enter</kbd> for new line
          </small>
          <!-- Hidden debug mode checkbox for JavaScript compatibility -->
          <input type="checkbox" id="debug-mode" style="display: none;">
        </div>
      </div>
    </main>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="settings-modal" style="display: none;">
    <div class="settings-modal-backdrop"></div>
    <div class="settings-modal-content">
      <div class="settings-modal-header">
        <h3>âš™ï¸ Settings</h3>
        <button id="close-settings" class="btn-icon" title="Close settings (ESC)">âœ•</button>
      </div>
      <div class="settings-modal-body">
        <!-- Models Management -->
        <section class="models-section">
          <h3>AI Models</h3>
          <div class="model-control-row">
            <label for="remote-select">Available Models:</label>
            <div class="model-control-inline">
              <select id="remote-select"></select>
              <button id="pull-btn" class="btn-primary">Download</button>
            </div>
            <span id="pull-msg" class="status-msg"></span>
          </div>
          <div class="model-control-row">
            <label for="local-select">Active Model:</label>
            <div class="model-control-inline">
              <select id="local-select"></select>
              <button id="run-btn" class="btn-primary">Use</button>
              <button id="delete-model-btn" class="btn-secondary" title="Delete selected model">ğŸ—‘ï¸</button>
            </div>
            <span id="run-msg" class="status-msg"></span>
          </div>
        </section>

        <!-- Options & Configuration -->
        <section class="options-section">
          <h3>âš™ï¸ Options</h3>
          
          <!-- Theme Selection -->
          <div class="option-group">
            <div id="theme-selector-container">
              <!-- Theme selector will be populated by JavaScript -->
            </div>
          </div>
          
          <!-- Debug Mode -->
          <div class="option-group">
            <div class="option-item">
              <label class="option-label">
                <input type="checkbox" id="debug-toggle" class="option-checkbox">
                <span>Debug Mode</span>
              </label>
              <small class="option-help">Enable verbose debugging and console output</small>
            </div>
          </div>
          
          <!-- API Explorer -->
          <div class="option-group">
            <div class="option-item">
              <button id="open-api-explorer" class="btn-primary" style="width: 100%; padding: 0.75rem; margin-top: 0.5rem;">
                ğŸ Open API Explorer
              </button>
              <small class="option-help">Explore and test all available API endpoints in a new tab</small>
            </div>
          </div>
        </section>

        <!-- System Status -->
        <section class="status-section">
          <h3>ğŸ“Š System Status</h3>
          <div id="status">
            <div class="status-item">
              <span class="status-label">Connection:</span>
              <span id="conn-status">ğŸ”´ Checking...</span>
            </div>
            <div class="status-item">
              <span class="status-label">ğŸ¤– AI Engine:</span>
              <span id="engine-info">--</span>
            </div>
            <div class="status-item">
              <span class="status-label">Memory:</span>
              <span id="memory-info">ğŸ’¾ Loading...</span>
            </div>
            <div class="status-item">
              <span class="status-label">ğŸ• Time:</span>
              <span id="datetime-full-info">--:-- | --/--/---- | --</span>
            </div>
          </div>
        </section>
      </div>
    </div>
  </div>

  <!-- Theme Info Popup -->
  <div id="theme-info-popup" class="theme-popup" style="display: none;">
    <div class="theme-popup-backdrop"></div>
    <div class="theme-popup-content">
      <div class="theme-popup-header">
        <h4 id="theme-popup-title">Theme Information</h4>
        <button id="close-theme-popup" class="btn-icon">âœ•</button>
      </div>
      <div class="theme-popup-body">
        <div class="theme-info">
          <p><strong>Name:</strong> <span id="theme-popup-name">-</span></p>
          <p><strong>Type:</strong> <span id="theme-popup-type">-</span></p>
          <p><strong>Author:</strong> <span id="theme-popup-author">-</span></p>
          <p><strong>Description:</strong> <span id="theme-popup-description">-</span></p>
          <div id="theme-colors-preview"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Core JavaScript modules -->
  <script src="/static/js/themes.js"></script>
  <script src="/static/js/documents-main.js"></script>
  
  <!-- Modular ES6 components -->
  <script type="module">
    // Import and initialize modular functionality
    import initializeModels from '/static/js/modules/models/models-main.js';
    import '/static/js/modules/ui/ui-main.js'; // UI auto-initializes
    import '/static/js/modules/chat/chat-main.js'; // Chat modules auto-initialize
    
    // Initialize when DOM is loaded
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        // Initialize models system
        initializeModels();
        console.log('âœ… Modular systems initialized');
      });
    } else {
      // Initialize models system
      initializeModels();
      console.log('âœ… Modular systems initialized');
    }
  </script>
  
  <!-- Main application initialization -->
  <script src="/static/js/main.js"></script>
</body>
</html>